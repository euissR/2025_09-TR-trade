fig5 %>%
# complete(dir, type, cat, name, fill = list(value = 0)) %>%
# pivot_wider(names_from = dir, values_from = value) %>%
# print()
filter(cat == "Import") %>%
write_csv("data/fig5_img.csv")
fig5 %>%
# complete(dir, type, cat, name, fill = list(value = 0)) %>%
# pivot_wider(names_from = dir, values_from = value) %>%
# print()
filter(cat == "Export") %>%
write_csv("data/fig5_exp.csv")
fig5 <- bind_rows(fig5_im, fig5_ex %>%
mutate(value = -value))
fig5 %>% filter(value < 0)
fig5 <- bind_rows(fig5_im, fig5_ex %>%
mutate(value = -value))
fig5_ex
fig5_im
mutate(value = ifelse(value < 0 , -value, value))
fig5_ex
fig5 <- bind_rows(fig5_im, fig5_ex) %>%
mutate(value = ifelse(value < 0 , -value, value))
fig5 %>%
# complete(dir, type, cat, name, fill = list(value = 0)) %>%
# pivot_wider(names_from = dir, values_from = value) %>%
# print()
filter(cat == "Import") %>%
write_csv("data/fig5_img.csv")
fig5 %>%
# complete(dir, type, cat, name, fill = list(value = 0)) %>%
# pivot_wider(names_from = dir, values_from = value) %>%
# print()
filter(cat == "Export") %>%
write_csv("data/fig5_exp.csv")
fig5
fig5 %>%
# complete(dir, type, cat, name, fill = list(value = 0)) %>%
# pivot_wider(names_from = dir, values_from = value) %>%
# print()
filter(cat == "Import") %>%
write_csv("data/fig5_img.csv")
fig5 %>%
# complete(dir, type, cat, name, fill = list(value = 0)) %>%
# pivot_wider(names_from = dir, values_from = value) %>%
# print()
filter(cat == "Export") %>%
write_csv("data/fig5_exp.csv")
fig5 <- bind_rows(fig5_im, fig5_ex)
fig5 %>%
# distinct(type) %>%
filter(str_detect(type, "Total")) %>%
# print()
ggplot() +
aes(name, value) +
geom_col(aes(fill = dir)) +
facet_wrap(~cat)
fig5 %>%
# complete(dir, type, cat, name, fill = list(value = 0)) %>%
pivot_wider(names_from = dir, values_from = value) %>%
# print()
write_csv("data/fig5.csv")
fig5 <- bind_rows(fig5_im, fig5_ex)
fig5 %>%
filter(cat == "Export") %>%
pivot_wider(names_from = dir, values_from = value) %>%
write_csv("data/fig5_exp.csv")
fig5 %>%
filter(cat == "Import") %>%
pivot_wider(names_from = dir, values_from = value) %>%
write_csv("data/fig5_img.csv")
fig5 %>%
filter(cat == "Export") %>%
pivot_wider(names_from = dir, values_from = value) %>%
mutate(label = ifelse(value < 0, -value, value)) %>%
write_csv("data/fig5_exp.csv")
fig5 %>%
filter(cat == "Import") %>%
pivot_wider(names_from = dir, values_from = value) %>%
mutate(label = ifelse(value < 0, -value, value)) %>%
write_csv("data/fig5_img.csv")
fig5 %>%
filter(cat == "Export") %>%
mutate(label = ifelse(value < 0, -value, value)) %>%
pivot_wider(names_from = dir, values_from = value) %>%
write_csv("data/fig5_exp.csv")
fig5 %>%
filter(cat == "Import") %>%
mutate(label = ifelse(value < 0, -value, value)) %>%
pivot_wider(names_from = dir, values_from = value) %>%
write_csv("data/fig5_img.csv")
fig5 %>%
filter(cat == "Export") %>%
# mutate(label = ifelse(value < 0, -value, value)) %>%
pivot_wider(names_from = dir, values_from = value) %>%
write_csv("data/fig5_exp.csv")
fig5 %>%
filter(cat == "Export") %>%
# mutate(label = ifelse(value < 0, -value, value)) %>%
pivot_wider(names_from = dir, values_from = value) %>%
print()
fig5 %>%
filter(cat == "Export") %>%
mutate(label = ifelse(value < 0, -value, value)) %>%
pivot_wider(names_from = dir, values_from = value) %>%
print()
fig5 %>%
filter(cat == "Export") %>%
mutate(label = ifelse(value < 0, -value, value)) %>%
pivot_wider(names_from = dir, values_from = value) %>%
print()
fig5 %>%
filter(cat == "Export") %>%
# mutate(label = ifelse(value < 0, -value, value)) %>%
pivot_wider(names_from = dir, values_from = value) %>%
print()
fig5 %>%
filter(cat == "Export") %>%
pivot_wider(names_from = dir, values_from = value) %>%
# mutate(label = ifelse(value < 0, -value, value)) %>%
write_csv("data/fig5_exp.csv")
fig5 %>%
filter(cat == "Import") %>%
# mutate(label = ifelse(value < 0, -value, value)) %>%
pivot_wider(names_from = dir, values_from = value) %>%
write_csv("data/fig5_img.csv")
fig8_value %>%
group_by(name) %>%
summarize(value = sum(value)) %>%
print()
fig8_value %>%
print()
fig8 %>%
arrange(type) %>%
filter(type == "ðŸ›ž Turbofan") %>%
print()
fig8 %>%
arrange(type) %>%
filter(type == "ðŸ›ž Turbofan") %>%
mutate(type = "Turbofan") %>%
# print()
# pivot_wider(names_from = model, values_from = value) %>%
# print()
# mutate(level = ifelse(is.na(level), lag(level), level))
write_csv("data/fig8.csv", na = "")
fig8 %>%
arrange(type) %>%
filter(type == "ðŸ›ž Turbofan") %>%
mutate(type = "Turbofan") %>%
pull(range(level))
fig8 %>%
arrange(type) %>%
filter(type == "ðŸ›ž Turbofan") %>%
mutate(type = "Turbofan") %>%
pull(level) %>% range()
fig8 %>%
arrange(type) %>%
filter(type == "ðŸ›ž Turbofan") %>%
mutate(type = "Turbofan",
level = case_match(
"1" ~ "â˜…â˜†â˜†â˜†â˜†",
"2" ~ "â˜…â˜…â˜†â˜†â˜†",
"3" ~ "â˜…â˜…â˜…â˜†â˜†",
"4" ~ "â˜…â˜…â˜…â˜…â˜†",
"5" ~ "â˜…â˜…â˜…â˜…â˜…"
)) %>%
# pull(level) %>% range()
# print()
# pivot_wider(names_from = model, values_from = value) %>%
# print()
# mutate(level = ifelse(is.na(level), lag(level), level))
write_csv("data/fig8.csv", na = "")
fig8 %>%
arrange(type) %>%
filter(type == "ðŸ›ž Turbofan") %>%
mutate(type = "Turbofan",
level = case_match(
level,
"1" ~ "â˜…â˜†â˜†â˜†â˜†",
"2" ~ "â˜…â˜…â˜†â˜†â˜†",
"3" ~ "â˜…â˜…â˜…â˜†â˜†",
"4" ~ "â˜…â˜…â˜…â˜…â˜†",
"5" ~ "â˜…â˜…â˜…â˜…â˜…"
)) %>%
# pull(level) %>% range()
# print()
# pivot_wider(names_from = model, values_from = value) %>%
# print()
# mutate(level = ifelse(is.na(level), lag(level), level))
write_csv("data/fig8.csv", na = "")
pal_seq_g(5)
pal_seq_g(5)
fig8 %>%
arrange(level) %>%
filter(type == "ðŸ›ž Turbofan") %>%
mutate(type = "Turbofan",
level = case_match(
level,
"1" ~ "â˜…â˜†â˜†â˜†â˜†",
"2" ~ "â˜…â˜…â˜†â˜†â˜†",
"3" ~ "â˜…â˜…â˜…â˜†â˜†",
"4" ~ "â˜…â˜…â˜…â˜…â˜†",
"5" ~ "â˜…â˜…â˜…â˜…â˜…"
)) %>%
# pull(level) %>% range()
# print()
# pivot_wider(names_from = model, values_from = value) %>%
# print()
# mutate(level = ifelse(is.na(level), lag(level), level))
write_csv("data/fig8.csv", na = "")
source("0 data.R")
fig1_balance <- read_excel("data/Figure 1 & 3 - General trade/New Microsoft Excel Worksheet.xlsx",
sheet = "general trade ",
range = "a1:s12") %>%
pivot_longer(`2009`:`2025`) %>%
rename(dir = flux,
cat = Products) %>%
mutate(cat = str_trim(cat),
dir = str_to_sentence(dir)) %>%
filter(dir == "Trade balance") %>%
print()
fig1_total <- read_excel("data/Figure 1 & 3 - General trade/New Microsoft Excel Worksheet.xlsx",
sheet = "general trade ",
range = "a1:s12") %>%
pivot_longer(`2009`:`2025`) %>%
rename(dir = flux,
cat = Products) %>%
mutate(cat = str_trim(cat),
dir = str_to_sentence(dir),
# AC turned imports negative and made it bn
value = ifelse(value < 0, -value, value)) %>%
filter(dir != "Trade balance") %>%
print()
fig1_export <- read_excel("data/Figure 1 & 3 - General trade/New Microsoft Excel Worksheet.xlsx",
sheet = "export",
range = "a1:r12") %>%
pivot_longer(`2009`:`2025`) %>%
rename(subcat = 1) %>%
mutate(cat = "Machinery & mechanical appliances") %>%
bind_rows(read_excel("data/Figure 1 & 3 - General trade/New Microsoft Excel Worksheet.xlsx",
sheet = "export",
range = "a17:r25") %>%
pivot_longer(`2009`:`2025`) %>%
rename(subcat = 1) %>%
mutate(cat = "Electrical machinery & equipment")) %>%
bind_rows(read_excel("data/Figure 1 & 3 - General trade/New Microsoft Excel Worksheet.xlsx",
sheet = "export",
range = "a31:r35") %>%
pivot_longer(`2009`:`2025`) %>%
rename(subcat = 1) %>%
mutate(cat = "Vehicles")) %>%
mutate(dir = "Export",
cat = str_trim(cat),
value = value / 1000) %>%
# rename(Export = value) %>%
print()
fig1_import <- read_excel("data/Figure 1 & 3 - General trade/New Microsoft Excel Worksheet.xlsx",
sheet = "import",
range = "a1:r5") %>%
pivot_longer(`2009`:`2025`) %>%
rename(subcat = 1) %>%
mutate(cat = "Mineral fuels & oil ",
value = value * 1000) %>% # this one is in billion, randomly
bind_rows(read_excel("data/Figure 1 & 3 - General trade/New Microsoft Excel Worksheet.xlsx",
sheet = "import",
range = "a15:r20") %>%
pivot_longer(`2009`:`2025`) %>%
rename(subcat = 1) %>%
mutate(cat = "Raw metals")) %>%
bind_rows(read_excel("data/Figure 1 & 3 - General trade/New Microsoft Excel Worksheet.xlsx",
sheet = "import",
range = "a30:r33") %>%
pivot_longer(`2009`:`2025`) %>%
rename(subcat = 1) %>%
mutate(cat = "Copper & articles thereof")) %>%
bind_rows(read_excel("data/Figure 1 & 3 - General trade/New Microsoft Excel Worksheet.xlsx",
sheet = "import",
range = "a46:r48") %>%
pivot_longer(`2009`:`2025`) %>%
rename(subcat = 1) %>%
mutate(cat = "Aluminium & articles thereof")) %>%
bind_rows(read_excel("data/Figure 1 & 3 - General trade/New Microsoft Excel Worksheet.xlsx",
sheet = "import",
range = "a61:r65") %>%
pivot_longer(`2009`:`2025`) %>%
rename(subcat = 1) %>%
mutate(cat = "Wood & articles of wood; charcoal")) %>%
mutate(dir = "Import",
cat = str_trim(cat),
value = value / 1000) %>%
# rename(Import = value) %>%
print()
fig1 <- fig1_export %>%
bind_rows(fig1_import) %>%
bind_rows(fig1_total %>%
filter(cat == "Other") %>%
mutate(subcat = "Other")) %>%
mutate(name = as.numeric(name)) %>%
print()
fig1 %>%
# group_by(dir, name) %>%
# summarize(sum = sum(value, na.rm = TRUE)) %>%
# ungroup() %>%
# mutate(y = ifelse(str_detect(dir, "Export"), sum, -sum)) %>%
ggplot() +
aes(name, ifelse(str_detect(dir, "Export"), value, -value)) +
geom_col(aes(fill = cat))
fig1_total %>%
# group_by(dir, name) %>% summarize(sum = sum(value)) %>%
# ungroup() %>%
# mutate(y = ) %>%
# print()
ggplot() +
aes(x = name, y = ifelse(str_detect(dir, "Export"), value, -value)) +
# aes(x = name, y = sum) +
geom_col(aes(fill = dir))
# full by direction (flourish)
fig1 %>%
#   mutate(value = ifelse(str_detect(dir, "Export"), value, -value)) %>%
#   mutate(value = ifelse(is.na(value), "", as.character(value))) %>%
#   pivot_wider(names_from = cat,
#               values_from = value,
#               values_fill = "") %>%
group_by(dir, cat, name) %>%
summarize(value = sum(value)) %>%
ungroup() %>%
# mutate(value = ifelse(str_detect(dir, "Export"), value, -value)) %>%
pivot_wider(
id_cols = c(name, dir),  # keep subcat, year, and direction as identifiers
names_from = cat,                # categories become column names
values_from = value,
values_fill = 0,
values_fn = sum
) %>%
# print()
write_csv("data/fig1.csv")
fig1_balance %>%
mutate(col = value > 0) %>%
write_csv("data/fig1_balance.csv")
fig1_balance
fig1 %>%
write_csv("data/fig1_breakdown.csv")
fig1
fig1_total %>%
write_csv("data/fig1_total.csv")
fig1_total
# for flourish
fig1_total %>%
group_by(dir, name) %>%
summarize(value = sum(value)) %>%
ungroup() %>%
pivot_wider(names_from = dir,
values_from = value,
values_fill = 0) %>%
mutate(Export = -Export) %>%
# print()
write_csv("data/fig1_total_dir.csv")
# for flourish
fig1_total %>%
group_by(dir, name) %>%
summarize(value = sum(value)) %>%
ungroup() %>%
pivot_wider(names_from = dir,
values_from = value,
values_fill = 0) %>%
mutate(Export = -Export) %>%
# print()
write_csv("data/fig1_total_dir.csv")
# for flourish
fig1_total %>%
group_by(dir, name) %>%
summarize(value = sum(value)) %>%
ungroup() %>%
pivot_wider(names_from = dir,
values_from = value,
values_fill = 0) %>%
mutate(Export = -Export) %>%
print()
fig1_total %>%
filter(dir == "Export") %>%
pivot_wider(names_from = cat, values_from = value) %>%
write_csv("data/fig1_total_export.csv")
fig1_total %>%
filter(dir == "Export") %>%
pivot_wider(names_from = cat, values_from = value) %>%
print()
fig1_total %>%
filter(dir == "Export") %>%
pivot_wider(names_from = cat, values_from = value) %>%
# print()
write_csv("data/fig1_total_export.csv")
source("0 data.R")
fig4_oil <- read_excel("data/Figure 4 - Energy diversification/Oil diversification.xlsx",
range = "a1:l10") %>%
rename(country = 1) %>%
pivot_longer(-country) %>%
mutate(name = as.numeric(name),
type = "Oil") %>%
print()
fig4_gas <- read_excel("data/Figure 4 - Energy diversification/Gas diversification.xlsx",
range = "a1:l9") %>%
rename(country = 1) %>%
pivot_longer(-country) %>%
mutate(name = as.numeric(name),
type = "Gas") %>%
print()
fig4_coal <- read_excel("data/Figure 4 - Energy diversification/Coal diversification.xlsx",
range = "a1:l7") %>%
rename(country = 1) %>%
pivot_longer(-country) %>%
mutate(name = as.numeric(name),
type = "Coal") %>%
print()
fig4 <- bind_rows(fig4_coal, fig4_gas, fig4_oil) %>%
filter(!str_detect(country, "HHI")) %>%
mutate(country = ifelse(str_detect(country, "ther"), "Other", country))
fig4_hhi <- bind_rows(fig4_coal, fig4_gas, fig4_oil) %>%
filter(str_detect(country, "HHI")) %>%
mutate(country = ifelse(str_detect(country, "ther"), "Other", country)) %>%
mutate(country = ifelse(str_detect(country, "HHI"), "Diversification index (HHI)", country))
fig4 %>%
ggplot() +
aes(name, value) +
geom_area(aes(fill = reorder(country, value),
alpha = ifelse(country == "Russia", 1, .33)),
col = "#fff",
position = "fill") +
scale_alpha_identity() +
facet_wrap(~type, nrow = 1)
fig4 %>%
complete(country, name, type, fill = list(value = 0)) %>%
pivot_wider(names_from = country, values_from = value) %>%
# print()
write_csv("data/fig4.csv")
fig4 %>%
complete(country, name, type, fill = list(value = 0)) %>%
pivot_wider(names_from = country, values_from = value) %>%
print()
fig4 %>%
complete(country, name, type, fill = list(value = 0)) %>%
pivot_wider(names_from = country, values_from = value,
values_fill = "") %>%
print()
fig4 %>%
complete(country, name, type, fill = list(value = 0)) %>%
pivot_wider(names_from = country, values_from = value,
values_fill = "") %>%
# print()
write_csv("data/fig4.csv",
na = "")
fig4 %>%
complete(country, name, type, fill = list(value = 0)) %>%
pivot_wider(names_from = country, values_from = value,
values_fill = "") %>%
print()
fig4 %>%
complete(country, name, type, fill = list(value = 0)) %>%
pivot_wider(names_from = country, values_from = value) %>%
print()
fig4 %>%
complete(country, name, type, fill = list(value = 0)) %>%
print()
mutate(value = ifelse(value == 0, "", value) %>%
fig4 %>%
complete(country, name, type, fill = list(value = 0)) %>%
mutate(value = ifelse(value == 0, "", value)) %>%
pivot_wider(names_from = country, values_from = value) %>%
print()
fig4 %>%
fig4 %>%
complete(country, name, type, fill = list(value = 0)) %>%
mutate(value = ifelse(value == 0, "", value)) %>%
pivot_wider(names_from = country, values_from = value) %>%
print()
fig4 %>%
complete(country, name, type, fill = list(value = 0)) %>%
mutate(value = ifelse(value == 0, "", value)) %>%
pivot_wider(names_from = country, values_from = value) %>%
# print()
write_csv("data/fig4.csv")
fig4 %>%
complete(country, name, type, fill = list(value = 0)) %>%
mutate(value = ifelse(value == 0, "", value)) %>%
pivot_wider(names_from = country, values_from = value) %>%
print()
fig4 %>%
complete(country, name, type, fill = list(value = 0)) %>%
mutate(value = ifelse(value == 0, "", value)) %>%
pivot_wider(names_from = country, values_from = value) %>%
# print()
write_csv("data/fig4.csv")
fig4 %>%
complete(country, name, type, fill = list(value = 0)) %>%
# mutate(value = ifelse(value == 0, "", value)) %>%
pivot_wider(names_from = country, values_from = value) %>%
# print()
write_csv("data/fig4.csv")
fig2 <- read_excel("data/Figure 2 - China_s export of cars to Russia/Cars_ export.xlsx",
range = "c1:bd2") %>%
pivot_longer(1:54,
names_to = "date") %>%
euiss_date_from_excel() %>%
print()
fig2 %>%
ggplot() +
aes(date, value) +
geom_line()
fig2 %>%
write_csv("data/fig2.csv")
fig2 %>%
mutate(value = value / 1000) %>%
write_csv("data/fig2.csv")
